```{r}
# Make sure to run loadclean.R first to load and clean data

df = df_subjective

df$Interface <- as.factor(df$Interface_Choice)
df$Remembered_Choice <- as.factor(df$Remembered_Choice)
df$PID <- as.factor(df$PID)

df$Interface <- dplyr::recode(df$Interface,
    "Baseline - static menu with ray-based selection" = "Baseline",
    "Portal - head-reference with linear menu" = "Portal_Gallery",
    "Portal - Palette with hand-based selections" = "Portal_Palette_Hand",
    "Portal - Palette with head-based selections" = "Portal_Palette_Head",
    "Portal - Steering Wheel" = "Portal_WorldWheel",
    "WIM - head-referenced with linear menu" = "WIM_Gallery",
    "WIM - Palette with hand-based selections" = "WIM_Palette_Hand",
    "WIM - Palette with head-based selections" = "WIM_Palette_Head",
    "WIM Steering Wheel" = "WIM_WorldWheel"
)

# Convert TLX items to long format
df_long <- df %>%
  tidyr::pivot_longer(cols = starts_with("TLX"), names_to = "TLX_Item", values_to = "Score") %>%
  mutate(TLX_Item = recode(TLX_Item,
                           "TLX_1_1" = "tlx_mental",
                           "TLX_2_1" = "tlx_physical",
                           "TLX_3_1" = "tlx_temporal",
                           "TLX_4_1" = "tlx_perf",
                           "TLX_5_1" = "tlx_effort",
                           "TLX_6_1" = "tlx_frustration"))

# Compute average TLX score
tlx_cols <- grep("^TLX_\\d+_1$", names(df), value = TRUE)
print(tlx_cols)
df$tlx_all = rowMeans(df[tlx_cols], na.rm = TRUE)

# Identify SUS columns
sus_cols <- grep("^SUS_\\d+_1$", names(df), value = TRUE)
print(sus_cols)

# Calculate SUS total score (commonly scaled to 0â€“100)
df$sus_score <- rowSums(df[sus_cols]) * 2.5  # 10 items * 2.5 = 100 max

# Get all UEQ columns (assuming UEQ_1_1 to UEQ_1_8 style)
ueq_cols <- grep("^UEQ_\\d+_\\d+(\\.\\d+)?$", names(df), value = TRUE)

# Sort and split columns
ueq_first4 <- ueq_cols[1:4]
ueq_last4  <- ueq_cols[5:8]

# Compute averages
df <- df %>%
  mutate(
    UEQ_Practical = rowMeans(across(all_of(ueq_first4)), na.rm = TRUE),
    UEQ_Hedonic   = rowMeans(across(all_of(ueq_last4)), na.rm = TRUE),
    UEQ_Overall   = rowMeans(across(all_of(ueq_cols)), na.rm = TRUE)
  )

# Pivot to long format for plotting
df_ueq_long <- df %>%
  select(Interface, UEQ_Practical, UEQ_Hedonic, UEQ_Overall) %>%
  tidyr::pivot_longer(cols = starts_with("UEQ"), names_to = "UEQ_Type", values_to = "Score")

# get Cont columns
cont_cols <- grep("^Cont_\\d+_1$", names(df), value = TRUE)
df$cont_avg = rowMeans(df[cont_cols], na.rm = TRUE)

df_subjective = df

```


```{r}
library(dplyr)
library(emmeans)
library(ARTool)
library(rstatix)
library(effectsize)

# Load data
data <- df_subjective

# Ensure columns are set right
data$ParticipantID <- as.factor(data$PID)
data$Interface <- as.factor(data$Interface)

# UEQ HEDONIC

# Print average hedonic score and 95% CI for each interface
data %>%
    group_by(Interface) %>%
    summarise(
        mean_hedonic = mean(UEQ_Hedonic, na.rm = TRUE),
        sd_hedonic = sd(UEQ_Hedonic, na.rm = TRUE),
        n = n(),
        se = sd_hedonic / sqrt(n),
        ci_lower = mean_hedonic - qt(0.975, df = n - 1) * se,
        ci_upper = mean_hedonic + qt(0.975, df = n - 1) * se
    ) %>%
    print()


# Run ART model
m.art.avg <- art(UEQ_Hedonic ~ Interface + Error(ParticipantID), data = data)

# ANOVA
anova_results <- anova(m.art.avg)
print(anova_results)

# Effect sizes (partial eta squared)
eta_squared_results <- eta_squared(anova_results, partial = TRUE)
print(format(eta_squared_results, digits=4))

# Contrasts
art.con(m.art.avg, ~ Interface, adjust = "bonferroni")
```


Continuity
```{r}
#CONTINUITY

# Print average continuity score and 95% CI for each interface
data %>%
    group_by(Interface) %>%
    summarise(
        mean_cont = mean(cont_avg, na.rm = TRUE),
        sd_cont = sd(cont_avg, na.rm = TRUE),
        n = n(),
        se = sd_cont / sqrt(n),
        ci_lower = mean_cont - qt(0.975, df = n - 1) * se,
        ci_upper = mean_cont + qt(0.975, df = n - 1) * se
    ) %>%
    print()

# Run ART model
m.art.avg <- art(cont_avg ~ Interface + Error(ParticipantID), data = data)

# ANOVA
anova_results <- anova(m.art.avg)
print(anova_results)

# Effect sizes (partial eta squared)
eta_squared_results <- eta_squared(anova_results, partial = TRUE)
print(format(eta_squared_results, digits=4))

# Contrasts
art.con(m.art.avg, ~ Interface, adjust = "bonferroni")
```

NASA TLX
```{r}
# NASA TLX

data %>%
    group_by(Interface) %>%
    summarise(
        mean_tlx = mean(tlx_all, na.rm = TRUE),
        sd_tlx = sd(tlx_all, na.rm = TRUE),
        n = n(),
        se = sd_tlx / sqrt(n),
        ci_lower = mean_tlx - qt(0.975, df = n - 1) * se,
        ci_upper = mean_tlx + qt(0.975, df = n - 1) * se
    ) %>%
    print()

# Run ART model
m.art.avg <- art(tlx_all ~ Interface + Error(ParticipantID), data = data)

# ANOVA
anova_results <- anova(m.art.avg)
print(anova_results)

# Effect sizes (partial eta squared)
eta_squared_results <- eta_squared(anova_results, partial = TRUE)
print(format(eta_squared_results, digits=4))

# Contrasts
art.con(m.art.avg, ~ Interface, adjust = "bonferroni")
```

SUS
```{r}
#SUS

data %>%
    group_by(Interface) %>%
    summarise(
        mean_sus = mean(sus_score, na.rm = TRUE),
        sd_sus = sd(sus_score, na.rm = TRUE),
        n = n(),
        se = sd_sus / sqrt(n),
        ci_lower = mean_sus - qt(0.975, df = n - 1) * se,
        ci_upper = mean_sus + qt(0.975, df = n - 1) * se
    ) %>%
    print()

# Run ART model
m.art.avg <- art(sus_score ~ Interface + Error(ParticipantID), data = data)

# ANOVA
anova_results <- anova(m.art.avg)
print(anova_results)

# Effect sizes (partial eta squared)
eta_squared_results <- eta_squared(anova_results, partial = TRUE)
print(format(eta_squared_results, digits=4))

# Contrasts
art.con(m.art.avg, ~ Interface, adjust = "bonferroni")
```
